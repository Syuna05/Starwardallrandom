<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>キャラ選択</title>
  <style>
    body { font-family: sans-serif; }
    .item-group { margin-bottom: 20px; }
    .item { display: inline-block; margin: 5px; text-align: center; cursor: pointer; }
    .item img { width: 80px; height: 80px; object-fit: cover; filter: brightness(50%); }
    .item.selected img { filter: brightness(100%); }
    .item-name { font-size: 0.8rem; }
    .cost-label { font-weight: bold; font-size: 1rem; margin-bottom: 5px; }
  </style>
</head>
<body>
  <h1>キャラ選択</h1>
  <div>
    <button id="drawButton">抽選</button>
    <button id="selectAllButton">全選択</button>
    <button id="deselectAllButton">全解除</button>
    <button id="resetButton">リセット</button>
    <label><input type="checkbox" id="hideAwakeningCheckbox"> 覚醒キャラを非表示</label>
  </div>
  <div id="totalDrawButtonCount">ボタンを押した回数: 0</div>
  <div id="itemContainer"></div>

  <script>
    window.onload = function () {
        const itemContainer = document.getElementById("itemContainer");

        const imageNames = [
            "グリフィン", "スズラン", "影", "キャヴァリー", "ラジエル",
            "エルフィン", "シュウウ", "ヒカリ", "ケルビム", "ライン", "ロタ", "イーザ",
            "18号", "アンジェリス", "フリード", "シグナス", "アリス", "カゼ", "ヴァルキア", "エヴァ",
            "轟雷", "シャープ", "スカイセーバー", "シャオリン", "稲", "ノーラ", "バーゼラルド",
            "チンニ", "ザハロワ", "ダークスター",
            "セラフィム", "ヴァーチェ", "エミカ", "スコーピオン", "パラス",
            "ヒビキ", "アイーダ", "スティレット", "デュカリオン", "ベータ",
            "カタリナ", "オーキッド", "スノーウォル", "ローランド", "ヤミン"
        ];

        const costs = ["30コス", "25コス", "20コス", "15コス"];
        const costRanges = { 30: 12, 25: 15, 20: 13, 15: 5 };

        const rearrangedImageNames = [
            ...imageNames.slice(0, 26),
            imageNames[26], imageNames[27],
            ...imageNames.slice(28)
        ];

        createItems(rearrangedImageNames, itemContainer, costs, costRanges);
        restoreSelection();
        restoreAwakeningState();

        let totalDrawButtonCount = getDrawButtonCount();
        document.getElementById("totalDrawButtonCount").textContent = `ボタンを押した回数: ${totalDrawButtonCount}`;

        document.getElementById("drawButton").addEventListener("click", () => {
            totalDrawButtonCount++;
            document.getElementById("totalDrawButtonCount").textContent = `ボタンを押した回数: ${totalDrawButtonCount}`;
            saveDrawButtonCount(totalDrawButtonCount);
        });

        document.getElementById("selectAllButton").addEventListener("click", () => {
            document.querySelectorAll(".item").forEach(el => el.classList.add("selected"));
            document.querySelectorAll(".item img").forEach(img => img.style.filter = "brightness(100%)");
            saveSelection();
        });

        document.getElementById("deselectAllButton").addEventListener("click", () => {
            document.querySelectorAll(".item").forEach(el => el.classList.remove("selected"));
            document.querySelectorAll(".item img").forEach(img => img.style.filter = "brightness(50%)");
            saveSelection();
        });

        document.getElementById("resetButton").addEventListener("click", () => {
            localStorage.clear();
            location.reload();
        });

        document.getElementById("hideAwakeningCheckbox").addEventListener("change", () => {
            saveAwakeningState();
        });
    };

    const specialSequenceMap = {
        "ローランド>スカイセーバー>シグナス": { name: "押井", cost: "20コス", img: "押井.png" },
        "シュウウ>デュカリオン>バーゼラルド>シャープ": { name: "高山", cost: "25コス", img: "高山.png" }
    };

    let clickSequence = [];

    function createItems(imageNames, parentElement, costs, costRanges) {
        let currentIndex = 0;
        costs.forEach(cost => {
            const itemGroup = document.createElement("div");
            itemGroup.classList.add("item-group");
            itemGroup.dataset.cost = cost;

            const costLabel = document.createElement("div");
            costLabel.classList.add("cost-label");
            costLabel.textContent = cost;
            itemGroup.appendChild(costLabel);

            const range = costRanges[parseInt(cost)] || 0;
            for (let i = 0; i < range; i++) {
                const itemDiv = document.createElement("div");
                itemDiv.classList.add("item");

                const img = document.createElement("img");
                img.src = `images/item${currentIndex + 1}.png`;
                img.alt = imageNames[currentIndex];
                img.dataset.index = currentIndex + 1;
                itemDiv.appendChild(img);

                const nameDiv = document.createElement("div");
                nameDiv.classList.add("item-name");
                nameDiv.textContent = imageNames[currentIndex];
                itemDiv.appendChild(nameDiv);

                itemDiv.addEventListener("click", () => {
                    itemDiv.classList.toggle("selected");
                    img.style.filter = itemDiv.classList.contains("selected") ? "brightness(100%)" : "brightness(50%)";
                    saveSelection();
                    trackSecretSequence(nameDiv.textContent);
                });

                itemGroup.appendChild(itemDiv);
                currentIndex++;
            }

            parentElement.appendChild(itemGroup);
        });
    }

    function trackSecretSequence(name) {
        clickSequence.push(name);
        if (clickSequence.length > 6) clickSequence.shift();

        for (const key in specialSequenceMap) {
            const targetSequence = key.split(">");
            if (clickSequence.slice(-targetSequence.length).join(">") === key) {
                const { name: secretName, cost, img } = specialSequenceMap[key];
                insertSecretCharacter(secretName, cost, img);
            }
        }
    }

    function insertSecretCharacter(name, cost, imgName) {
        const targetGroup = [...document.querySelectorAll(".item-group")].find(group => group.dataset.cost === cost);
        if (!targetGroup) return;
        if ([...targetGroup.querySelectorAll(".item-name")].some(el => el.textContent === name)) return;

        const itemDiv = document.createElement("div");
        itemDiv.classList.add("item", "selected");

        const img = document.createElement("img");
        img.src = `images/${imgName}`;
        img.alt = name;
        img.style.filter = "brightness(100%)";
        itemDiv.appendChild(img);

        const nameDiv = document.createElement("div");
        nameDiv.classList.add("item-name");
        nameDiv.textContent = name;
        itemDiv.appendChild(nameDiv);

        itemDiv.addEventListener("click", () => {
            itemDiv.classList.toggle("selected");
            img.style.filter = itemDiv.classList.contains("selected") ? "brightness(100%)" : "brightness(50%)";
            saveSelection();
        });

        targetGroup.appendChild(itemDiv);
        saveSelection();
    }

    function saveSelection() {
        // 実装内容省略（ローカルストレージ保存処理）
    }

    function restoreSelection() {
        // 実装内容省略（ローカルストレージ復元処理）
    }

    function getDrawButtonCount() {
        return parseInt(localStorage.getItem("drawButtonCount") || "0");
    }

    function saveDrawButtonCount(count) {
        localStorage.setItem("drawButtonCount", count);
    }

    function saveAwakeningState() {
        const checked = document.getElementById("hideAwakeningCheckbox").checked;
        localStorage.setItem("hideAwakening", checked);
    }

    function restoreAwakeningState() {
        const checked = localStorage.getItem("hideAwakening") === "true";
        document.getElementById("hideAwakeningCheckbox").checked = checked;
    }
  </script>
</body>
</html>
